@page "/billing/invoices"
@attribute [Authorize]

<PageTitle>Invoices</PageTitle>

<MudStack Spacing="4">
    <MudStack Row="true" Justify="Justify.SpaceBetween" AlignItems="AlignItems.Center">
        <MudText Typo="Typo.h4">Invoices</MudText>
    </MudStack>

    <!-- Filters -->
    <MudPaper Elevation="2" Class="pa-4">
        <MudGrid>
            <MudItem xs="12" sm="6" md="3">
                <MudSelect T="InvoiceStatus?" Label="Status" @bind-Value="_statusFilter" Clearable="true">
                    <MudSelectItem T="InvoiceStatus?" Value="@((InvoiceStatus?)null)">All</MudSelectItem>
                    <MudSelectItem T="InvoiceStatus?" Value="@InvoiceStatus.Draft">Draft</MudSelectItem>
                    <MudSelectItem T="InvoiceStatus?" Value="@InvoiceStatus.Issued">Issued</MudSelectItem>
                    <MudSelectItem T="InvoiceStatus?" Value="@InvoiceStatus.PartiallyPaid">Partially Paid</MudSelectItem>
                    <MudSelectItem T="InvoiceStatus?" Value="@InvoiceStatus.Paid">Paid</MudSelectItem>
                    <MudSelectItem T="InvoiceStatus?" Value="@InvoiceStatus.Overdue">Overdue</MudSelectItem>
                    <MudSelectItem T="InvoiceStatus?" Value="@InvoiceStatus.Voided">Voided</MudSelectItem>
                </MudSelect>
            </MudItem>
            <MudItem xs="12" sm="6" md="3">
                <MudButton Variant="Variant.Filled" Color="Color.Primary" 
                           OnClick="ApplyFiltersAsync" FullWidth="true">
                    Apply Filters
                </MudButton>
            </MudItem>
        </MudGrid>
    </MudPaper>

    <BusyBoundary Retry="LoadInvoicesAsync">
        @if (_invoices == null || !_invoices.Any())
        {
            <MudAlert Severity="Severity.Info">No invoices found.</MudAlert>
        }
        else
        {
            <MudDataGrid Items="@_invoices" Hover="true" Dense="true" Striped="true">
                <Columns>
                    <PropertyColumn Property="x => x.InvoiceNumber" Title="Invoice #" />
                    <PropertyColumn Property="x => x.InvoiceDate" Title="Date" Format="yyyy-MM-dd" />
                    <PropertyColumn Property="x => x.DueDate" Title="Due Date" Format="yyyy-MM-dd" />
                    <PropertyColumn Property="x => x.BillingPeriodStart" Title="Period Start" Format="yyyy-MM-dd" />
                    <PropertyColumn Property="x => x.BillingPeriodEnd" Title="Period End" Format="yyyy-MM-dd" />
                    <TemplateColumn Title="Status">
                        <CellTemplate>
                            @GetStatusChip(context.Item.Status)
                        </CellTemplate>
                    </TemplateColumn>
                    <PropertyColumn Property="x => x.TotalAmount" Title="Total" Format="C" />
                    <PropertyColumn Property="x => x.BalanceAmount" Title="Balance" Format="C" />
                    <TemplateColumn Title="Actions" Sortable="false">
                        <CellTemplate>
                            <MudStack Row="true" Spacing="1">
                                <MudIconButton Icon="@Icons.Material.Filled.Visibility" Size="Size.Small" 
                                               Href="@($"/billing/invoices/{context.Item.Id}")" Color="Color.Primary" />
                            </MudStack>
                        </CellTemplate>
                    </TemplateColumn>
                </Columns>
                <PagerContent>
                    <MudDataGridPager T="InvoiceDto" />
                </PagerContent>
            </MudDataGrid>
        }
    </BusyBoundary>
</MudStack>

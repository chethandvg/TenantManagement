@page "/accept-invite"
@attribute [AllowAnonymous]

<PageTitle>Accept Invite - TentMan</PageTitle>

<MudContainer MaxWidth="MaxWidth.Small" Class="mt-8">
    <MudPaper Elevation="3" Class="pa-8">
        @if (_isValidating)
        {
            <MudStack AlignItems="AlignItems.Center" Spacing="3">
                <MudProgressCircular Indeterminate="true" Size="Size.Large" />
                <MudText Typo="Typo.h6">Validating invite...</MudText>
            </MudStack>
        }
        else if (!_isValid)
        {
            <MudStack AlignItems="AlignItems.Center" Spacing="3">
                <MudIcon Icon="@Icons.Material.Filled.Error" Color="Color.Error" Size="Size.Large" />
                <MudText Typo="Typo.h5" Color="Color.Error">Invalid Invite</MudText>
                <MudText Typo="Typo.body1" Align="Align.Center">@_errorMessage</MudText>
                <MudButton Variant="Variant.Filled" Color="Color.Primary" Href="/login">
                    Go to Login
                </MudButton>
            </MudStack>
        }
        else
        {
            <MudStack Spacing="3">
                <MudText Typo="Typo.h4" Align="Align.Center" GutterBottom="true">
                    Welcome, @_tenantFullName!
                </MudText>
                <MudText Typo="Typo.body1" Align="Align.Center">
                    Create your account to access your tenant portal
                </MudText>

                <MudDivider />

                <EditForm Model="@_model" OnValidSubmit="HandleAcceptInviteAsync">
                    <DataAnnotationsValidator />

                    <MudTextField @bind-Value="_model.UserName"
                                 Label="Username"
                                 Variant="Variant.Outlined"
                                 Required="true"
                                 Margin="Margin.Normal"
                                 FullWidth="true"
                                 AutoFocus="true" />

                    <MudTextField @bind-Value="_model.Email"
                                 Label="Email"
                                 Variant="Variant.Outlined"
                                 InputType="InputType.Email"
                                 Required="true"
                                 Margin="Margin.Normal"
                                 FullWidth="true"
                                 HelperText="@(_inviteEmail != null ? $"Suggested: {_inviteEmail}" : "")" />

                    <MudTextField @bind-Value="_model.Password"
                                 Label="Password"
                                 Variant="Variant.Outlined"
                                 InputType="InputType.Password"
                                 Required="true"
                                 Margin="Margin.Normal"
                                 FullWidth="true"
                                 HelperText="Minimum 8 characters" />

                    <MudTextField @bind-Value="_model.ConfirmPassword"
                                 Label="Confirm Password"
                                 Variant="Variant.Outlined"
                                 InputType="InputType.Password"
                                 Required="true"
                                 Margin="Margin.Normal"
                                 FullWidth="true" />

                    @if (!string.IsNullOrEmpty(_submitError))
                    {
                        <MudAlert Severity="Severity.Error" Class="mt-4">
                            @_submitError
                        </MudAlert>
                    }

                    <MudButton ButtonType="ButtonType.Submit"
                              Variant="Variant.Filled"
                              Color="Color.Primary"
                              FullWidth="true"
                              Size="Size.Large"
                              Class="mt-6"
                              Disabled="@_isSubmitting">
                        @if (_isSubmitting)
                        {
                            <MudProgressCircular Size="Size.Small" Indeterminate="true" Class="mr-2" />
                            <MudText>Creating Account...</MudText>
                        }
                        else
                        {
                            <MudText>Create Account & Login</MudText>
                        }
                    </MudButton>
                </EditForm>
            </MudStack>
        }
    </MudPaper>
</MudContainer>
